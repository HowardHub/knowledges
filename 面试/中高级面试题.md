一、如何不用xxl-job写一个定时任务，实现手动和定时执行的功能，并且如何保证并发问题？





二、如果在controller层调用了两个加了事务的service方法，会不会有什么问题？如何保证日志记录（出现回滚也要记录日志）

无法保证事务回滚。**因为spring的事务是基于aop实现的，aop的底层又是动态代理，调用service的不同会生成不同的代理对象,所以不能保证一个事务。**





如何保证日志记录
 1、@Async注解设置异步执行，轻量切线程脱离事务控制，能满足方法中特殊场景数值的记载。
 2、@Transactional(propagation = Propagation.NOT_SUPPORTED) ，另起事务的方式操作，本质上和方法一是一个思路，另起线程，但操作范围大了，事务链的控制也比较繁琐。
 3、aop方式 ，有点是在可以指定范围内的类 方法批量的进行切面拦截处理，在进入前 结束后 还有所谓的环绕等，进行各种操作。操作的面更广，但是有个缺点是绕不开的，如果你要取到方法中特殊场景的某个值，那aop统一处理显然就不合适（取不到特定情况的值），通用性强，意味着牺牲了特殊性的处理。
 仅限于记录通用的信息，比如入参，入参（返回值），异常信息等。不时候记录中间特殊的场景。
 四、错误的方式
 1、在catch中处理？

```php
catch (Exception e){
              logger.error("推送{失败 失败 error:-->{}, [ inParam]={}",e.getMessage(), inParam,e);
              logService.doExceptionLog(cacheInparamVO);
              throw  new BusinessException(e);
        }
```

显然doExceptionLog也是被回滚
 2、在finally处理？

```csharp
finally{
    logService.doFinallyLog(cacheInparamVO);
}
```

结果和catch处理一样。





三、点击一个按钮，出现不动如何排查问题？





四、单体服务同时点击，除了在service层加锁，如何在MySQL层面实现线程安全？

乐观锁假设认为数据一般情况下不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测，如果发现冲突了，则让返回用户错误的信息，拒绝操作。





五、多对多的关系表如何设计？

解决方案：增加一张中间关系表
老师与学生的关系表：ID(P),T_ID,S_ID
老师表与中间表形成一对多的关系，而中间表是多表；维护了能够唯一找到一表的关系；
同样的学生表与中间表也是一个一对多的关系;



六、MySQL如何实现去重？

1.使用distinct

2.delete from user where id not in ( select f.id from ((select id from user group by name order by id))f);



